# install.packages("devtools")
# devtools::install_github("business-science/tidyquant")
# install.packages("broom")
library(knitr)
library(tidyverse)
library(tidyr)
library(tibble)
library(lubridate)
library(TTR)
library(tidyquant)
library(broom)
library(corrr)
library(alfred)
library(RcppRoll)
library(Hmisc)
library(kableExtra)
library(huxtable)
library(pracma)
library(gridExtra)
library(xts)
library(scales)
library(directlabels)
library(ggthemes)
library(ggfortify)
library(zoo)  # used for rollmean
library(padr)
library(roll)
# Data acquisition libraries
library(Quandl)
library(quantmod)
library(fredr)  # Fred
library(imfr, warn.conflicts = FALSE, quietly=TRUE)  # IMF
library(gdata)
library(readxl)
library(rstudioapi)
library(openxlsx)
library(fpp2)  # Hyndman Forecast package
library(DataCombine)
# Specific API  data
# library(devtools)
# install_github('mikeasilva/blsAPI')
library(blsAPI)
library(blsR)
# User defined functions
source("./chart_recession.R")  # for add_rec_shade recession shading function
# source("./signal_aggregation_functions.R")
# source("./financial_functions.R")
# source("./cycleanalytics.R")
install.packages("blsAPI")
options(digits = 4)
options(scipen=999)
# Get data from BLS
df_joc = get_n_series_table(
list( copper ='wpu102301', cotton = 'wpu015', natgas = 'wpu0531', burlap = 'wpu033703', copper_nickel = 'wpu102', steelscrap = 'wpu1012', zinc = 'wpu102303', aluminum = 'wpu102302', hides = 'wpu041', rubber = 'wpu071', tallow = 'wpu06410132', plywood = 'wpu083', hardwood = 'wpu0812', aromatics = 'wpu06140197', crudepetroleum = 'wpu056', cpi = 'CUUR0000SA0'),
api_key = "9f4c1becb3c546b689e1b9804d877d1e",
start_year = 2005, end_year=2023, tidy=TRUE
)
# Create date from Mon and Year
df_joc = df_joc %>%
mutate(df_joc, date=paste(year,month,1,sep="-"))
df_joc$date = ymd(df_joc$date)
# Make date first column
df_joc = df_joc %>% relocate(date)
# Rmove Mon and Year
df_joc <- subset(df_joc, select = -c(year, month))
# Fill NA's with previous value
df_joc <- fill(df_joc, names(df_joc))
# Create equal weighted composite
df_joc$joc_eq_wt = rowSums(df_joc[, -1]) / 15
# lag CPI by 13 months
df_joc$cpilag13 = lead(df_joc$cpi, n=1)
# Scale Values to 100
df_joc = df_joc %>%
mutate_each(funs(./.[1]*100), setdiff(names(.), "date"))
df_joc_mod = df_joc
```{r}
ggplot(df_joc, aes( x= date, y=cpi)) +
geom_line(aes(x = date, y = cpi * 2), color = "red") +
geom_line(aes(x = date, y = joc_eq_wt))
df_joc_mod = df_joc
df_joc_mod = df_joc_mod %>%
select(-c(cpi))
df_joc_mod_log = log(df_joc_mod[ , 2:18])
# add date column back in
df_joc_mod_log = df_joc_mod_log %>%
mutate(date = df_joc$date, .before = copper)
# Detrend data
df_joc_mod_log = df_joc_mod_log %>%
mutate(joc_eq_wt_diff = joc_eq_wt - lag(joc_eq_wt, n = 12)) %>%
mutate(cpilag13_diff = cpilag13 - lag(cpilag13, n = 12))
ggplot(df_joc_mod_log, aes(joc_eq_wt_diff, cpilag13_diff)) +
geom_point(aes(color = date))
ggplot(df_joc_mod_log, aes(joc_eq_wt_diff, cpilag13_diff)) +
geom_point(aes(color = date)) +
geom_path(aes(color = date))
# add date column back in
df_joc_mod = df_joc_mod %>%
mutate(date = df_joc$date, .before = copper)
# Detrend data
df_joc_mod = df_joc %>%
mutate(joc_eq_wt_diff = joc_eq_wt - lag(joc_eq_wt, n = 12)) %>%
mutate(cpilag13_diff = cpilag13 - lag(cpilag13, n = 12))
ggplot(df_joc_mod_log, aes(joc_eq_wt_diff, cpilag13_diff)) +
geom_point(aes(color = date)) +
geom_path(aes(color = date))
ggplot(df_joc_mod, aes(joc_eq_wt_diff, cpilag13_diff)) +
geom_point(aes(color = date)) +
geom_path(aes(color = date))
gplot(data = df_joc_mod,aes(joc_eq_wt_diff, cpilag13_diff)) +
stat_summary(fun.data= mean_cl_normal) +
geom_smooth(method='lm')
ggplot(data = df_joc_mod,aes(joc_eq_wt_diff, cpilag13_diff)) +
stat_summary(fun.data= mean_cl_normal) +
geom_smooth(method='lm')
summary(df_joc)
df_joc_mod = df_joc_mod %>%
select(-c(date, cpi, joc_eq_wt))
fit1 <- lm(cpilag13 ~ ., data=df_joc_mod)
summary(fit1)
library(MASS)
fit1 =lm(cpilag13 ~ ., data=df_joc_mod)
step = stepAIC(fit1, direction="both")
step$anova # display results
df_joc_mod = df_joc_mod %>%
select(-c(date, cpi, joc_eq_wt))
fit2 = lm(cpilag13 ~ natgas + burlap + copper_nickel + steelscrap + zinc +
aluminum + hides + rubber + plywood + hardwood + crudepetroleum, data = df_joc_mod)
summary(fit2)
df_joc_mod = df_joc_mod %>%
select(-c(date, cpi, joc_eq_wt))
View(df_joc)
View(df_joc_mod)
df_joc_mod = df_joc_mod %>%
select(-c(cpi, joc_eq_wt))
View(df_joc_mod)
View(df_joc_mod)
df_joc_mod = df_joc_mod %>%
select(-c(cpilag13_diff, joc_eq_wt_diff))
View(df_joc_mod)
View(df_joc_mod)
df_joc_mod = df_joc_mod %>%
select(-c(cpilag13_diff, joc_eq_wt_diff))
summary(df_joc)
summary(df_joc_mod)
fit2 = lm(cpilag13 ~ natgas + burlap + copper_nickel + steelscrap + zinc +
aluminum + hides + rubber + plywood + hardwood + crudepetroleum, data = df_joc_mod)
summary(fit2)
summary(df_joc_mod)
df_joc_mod = df_joc_mod %>%
select(-c(cpilag13_diff, joc_eq_wt_diff))
fit1 <- lm(cpilag13 ~ ., data=df_joc_mod)
summary(fit1)
df_joc_mod = df_joc_mod %>%
select(-c(joc_eq_wt_diff))
# Tidy libraries
# install.packages("devtools")
# devtools::install_github("business-science/tidyquant")
# install.packages("broom")
library(knitr)
library(tidyverse)
library(tidyr)
library(tibble)
library(lubridate)
library(TTR)
library(tidyquant)
library(broom)
library(corrr)
library(alfred)
library(RcppRoll)
library(Hmisc)
library(kableExtra)
library(huxtable)
library(pracma)
library(gridExtra)
library(xts)
library(scales)
library(directlabels)
library(ggthemes)
library(ggfortify)
library(zoo)  # used for rollmean
library(padr)
library(roll)
# Data acquisition libraries
library(Quandl)
library(quantmod)
library(fredr)  # Fred
library(imfr, warn.conflicts = FALSE, quietly=TRUE)  # IMF
library(gdata)
library(readxl)
library(rstudioapi)
library(openxlsx)
library(fpp2)  # Hyndman Forecast package
library(DataCombine)
# Specific API  data
# library(devtools)
# install_github('mikeasilva/blsAPI')
# library(blsAPI)
library(blsR)
# User defined functions
source("./chart_recession.R")  # for add_rec_shade recession shading function
# source("./signal_aggregation_functions.R")
# source("./financial_functions.R")
# source("./cycleanalytics.R")
df_joc_mod = df_joc_mod %>%
select(-c(joc_eq_wt_diff))
summary(df_joc_mod)
df_joc_mod %>%
select(-c(joc_eq_wt_diff))
View(df_joc_mod)
df_joc_mod %>%
select(-joc_eq_wt_diff)
# Tidy libraries
# install.packages("devtools")
# devtools::install_github("business-science/tidyquant")
# install.packages("broom")
library(knitr)
library(tidyverse)
library(tidyr)
library(tibble)
library(lubridate)
library(TTR)
library(tidyquant)
library(broom)
library(corrr)
library(alfred)
library(RcppRoll)
library(Hmisc)
library(kableExtra)
library(huxtable)
library(pracma)
library(gridExtra)
library(xts)
library(scales)
library(directlabels)
library(ggthemes)
library(ggfortify)
library(zoo)  # used for rollmean
library(padr)
library(roll)
# Data acquisition libraries
library(Quandl)
library(quantmod)
library(fredr)  # Fred
library(imfr, warn.conflicts = FALSE, quietly=TRUE)  # IMF
library(gdata)
library(readxl)
library(rstudioapi)
library(openxlsx)
library(fpp2)  # Hyndman Forecast package
library(DataCombine)
# Specific API  data
# library(devtools)
# install_github('mikeasilva/blsAPI')
# library(blsAPI)
library(blsR)
# User defined functions
source("./chart_recession.R")  # for add_rec_shade recession shading function
# source("./signal_aggregation_functions.R")
# source("./financial_functions.R")
# source("./cycleanalytics.R")
options(digits = 4)
options(scipen=999)
# Get data from BLS
df_joc = get_n_series_table(
list( copper ='wpu102301', cotton = 'wpu015', natgas = 'wpu0531', burlap = 'wpu033703', copper_nickel = 'wpu102', steelscrap = 'wpu1012', zinc = 'wpu102303', aluminum = 'wpu102302', hides = 'wpu041', rubber = 'wpu071', tallow = 'wpu06410132', plywood = 'wpu083', hardwood = 'wpu0812', aromatics = 'wpu06140197', crudepetroleum = 'wpu056', cpi = 'CUUR0000SA0'),
api_key = "9f4c1becb3c546b689e1b9804d877d1e",
start_year = 2005, end_year=2023, tidy=TRUE
)
# Create date from Mon and Year
df_joc = df_joc %>%
mutate(df_joc, date=paste(year,month,1,sep="-"))
df_joc$date = ymd(df_joc$date)
# Make date first column
df_joc = df_joc %>% relocate(date)
# Rmove Mon and Year
df_joc <- subset(df_joc, select = -c(year, month))
# Fill NA's with previous value
df_joc <- fill(df_joc, names(df_joc))
# Create equal weighted composite
df_joc$joc_eq_wt = rowSums(df_joc[, -1]) / 15
# lag CPI by 13 months
df_joc$cpilag13 = lead(df_joc$cpi, n=1)
# Scale Values to 100
df_joc = df_joc %>%
mutate_each(funs(./.[1]*100), setdiff(names(.), "date"))
df_joc_mod = df_joc
df_joc_mod = df_joc
df_joc_mod = df_joc_mod %>%
select(-c(cpi))
View(df_joc)
df_joc_mod = df_joc_mod %>%
tidyr::select(-c(cpi))
df_joc_mod = df_joc_mod %>%
dyplr::select(-c(cpi))
df_joc_mod = df_joc_mod %>%
dpylr::select(-c(cpi))
df_joc_mod = df_joc_mod %>%
dplyr::select(-c(cpi))
View(df_joc_mod)
df_joc_mod = df_joc
df_joc_mod = df_joc_mod %>%
dplyr::select(-c(cpi))
df_joc_mod_log = log(df_joc_mod[ , 2:18])
# add date column back in
df_joc_mod_log = df_joc_mod_log %>%
mutate(date = df_joc$date, .before = copper)
# Detrend data
df_joc_mod_log = df_joc_mod_log %>%
mutate(joc_eq_wt_diff = joc_eq_wt - lag(joc_eq_wt, n = 12)) %>%
mutate(cpilag13_diff = cpilag13 - lag(cpilag13, n = 12))
ggplot(df_joc_mod_log, aes(joc_eq_wt_diff, cpilag13_diff)) +
geom_point(aes(color = date)) +
geom_path(aes(color = date))
df_joc_mod = df_joc
df_joc_mod = df_joc_mod %>%
dplyr::select(-c(cpi))
# add date column back in
df_joc_mod = df_joc_mod %>%
mutate(date = df_joc$date, .before = copper)
# Detrend data
df_joc_mod = df_joc %>%
mutate(joc_eq_wt_diff = joc_eq_wt - lag(joc_eq_wt, n = 12)) %>%
mutate(cpilag13_diff = cpilag13 - lag(cpilag13, n = 12))
ggplot(df_joc_mod, aes(joc_eq_wt_diff, cpilag13_diff)) +
geom_point(aes(color = date)) +
geom_path(aes(color = date))
View(df_joc_mod)
ggplot(data = df_joc_mod,aes(joc_eq_wt_diff, cpilag13_diff)) +
stat_summary(fun.data= mean_cl_normal) +
geom_smooth(method='lm')
summary(df_joc_mod)
df_joc_mod %>%
dplyr::select(-c(joc_eq_wt_diff))
fit1 <- lm(cpilag13 ~ ., data=df_joc_mod)
summary(fit1)
df_joc_mod %>%
dplyr::select(-c(joc_eq_wt_diff, joc_eq_wt_diff, cpilag13_diff))
fit1 <- lm(cpilag13 ~ ., data=df_joc_mod)
summary(fit1)
summary(df_joc_mod)
df_joc_mod %>%
dplyr::select(-c(joc_eq_wt_diff, joc_eq_wt_diff, cpilag13_diff))
fit1 <- lm(cpilag13 ~ ., data=df_joc_mod)
summary(fit1)
View(df_joc_mod)
df_joc_mod = df_joc_mod %>%
dplyr::select(-c(joc_eq_wt_diff, joc_eq_wt_diff, cpilag13_diff))
fit1 <- lm(cpilag13 ~ ., data=df_joc_mod)
summary(fit1)
summary(df_joc_mod)
df_joc_mod = df_joc_mod %>%
dplyr::select(-c(joc_eq_wt_diff, joc_eq_wt, cpilag13_diff))
fit1 <- lm(cpilag13 ~ ., data=df_joc_mod)
summary(df_joc_mod)
df_joc_mod = df_joc_mod %>%
dplyr::select(-c(joc_eq_wt_diff, joc_eq_wt, cpilag13_diff))
summary(df_joc_mod)
View(df_joc_mod)
df_joc_mod = df_joc
df_joc_mod = df_joc_mod %>%
dplyr::select(-c(cpi))
# add date column back in
df_joc_mod = df_joc_mod %>%
mutate(date = df_joc$date, .before = copper)
# Detrend data
df_joc_mod = df_joc %>%
mutate(joc_eq_wt_diff = joc_eq_wt - lag(joc_eq_wt, n = 12)) %>%
mutate(cpilag13_diff = cpilag13 - lag(cpilag13, n = 12))
ggplot(df_joc_mod, aes(joc_eq_wt_diff, cpilag13_diff)) +
geom_point(aes(color = date)) +
geom_path(aes(color = date))
View(df_joc_mod)
summary(df_joc_mod)
df_joc_mod = df_joc_mod %>%
dplyr::select(-c(joc_eq_wt_diff, joc_eq_wt, cpilag13_diff))
fit1 <- lm(cpilag13 ~ ., data=df_joc_mod)
summary(fit1)
library(MASS)
fit1 =lm(cpilag13 ~ ., data=df_joc_mod)
step = stepAIC(fit1, direction="both")
step$anova # display results
View(df_joc)
df_joc_mod = df_joc
df_joc_mod = df_joc
summary(df_joc_mod)
df_joc_mod = df_joc_mod %>%
dplyr::select(-c(date, joc_eq_wt_diff, joc_eq_wt, cpilag13_diff))
View(df_joc_mod)
df_joc_mod = df_joc
View(df_joc_mod)
# Get data from BLS
df_joc = get_n_series_table(
list( copper ='wpu102301', cotton = 'wpu015', natgas = 'wpu0531', burlap = 'wpu033703', copper_nickel = 'wpu102', steelscrap = 'wpu1012', zinc = 'wpu102303', aluminum = 'wpu102302', hides = 'wpu041', rubber = 'wpu071', tallow = 'wpu06410132', plywood = 'wpu083', hardwood = 'wpu0812', aromatics = 'wpu06140197', crudepetroleum = 'wpu056', cpi = 'CUUR0000SA0'),
api_key = "9f4c1becb3c546b689e1b9804d877d1e",
start_year = 2005, end_year=2023, tidy=TRUE
)
# Create date from Mon and Year
df_joc = df_joc %>%
mutate(df_joc, date=paste(year,month,1,sep="-"))
df_joc$date = ymd(df_joc$date)
# Make date first column
df_joc = df_joc %>% relocate(date)
# Rmove Mon and Year
df_joc <- subset(df_joc, select = -c(year, month))
# Fill NA's with previous value
df_joc <- fill(df_joc, names(df_joc))
# Create equal weighted composite
df_joc$joc_eq_wt = rowSums(df_joc[, -1]) / 15
# lag CPI by 13 months
df_joc$cpilag13 = lead(df_joc$cpi, n=1)
# Scale Values to 100
df_joc = df_joc %>%
mutate_each(funs(./.[1]*100), setdiff(names(.), "date"))
df_joc_mod = df_joc
View(df_joc)
df_joc_mod = df_joc
summary(df_joc_mod)
df_joc_mod = df_joc_mod %>%
dplyr::select(-c(date, joc_eq_wt))
fit1 <- lm(cpilag13 ~ ., data=df_joc_mod)
summary(fit1)
library(MASS)
fit1 =lm(cpilag13 ~ ., data=df_joc_mod)
step = stepAIC(fit1, direction="both")
step$anova # display results
fit2 = lm(cpilag13 ~ cotton + natgas + burlap + copper_nickel + steelscrap +
hides + rubber + plywood + aromatics + cpi, data = df_joc_mod)
summary(fit2)
View(df_joc)
# Get data from BLS
df_joc = get_n_series_table(
list( copper ='wpu102301', cotton = 'wpu015', natgas = 'wpu0531', burlap = 'wpu033703', copper_nickel = 'wpu102', steelscrap = 'wpu1012', zinc = 'wpu102303', aluminum = 'wpu102302', hides = 'wpu041', rubber = 'wpu071', tallow = 'wpu06410132', plywood = 'wpu083', hardwood = 'wpu0812', aromatics = 'wpu06140197', crudepetroleum = 'wpu056', cpi = 'CUUR0000SA0'),
api_key = "9f4c1becb3c546b689e1b9804d877d1e",
start_year = 2005, end_year=2023, tidy=TRUE
)
# Create date from Mon and Year
df_joc = df_joc %>%
mutate(df_joc, date=paste(year,month,1,sep="-"))
df_joc$date = ymd(df_joc$date)
# Make date first column
df_joc = df_joc %>% relocate(date)
# Rmove Mon and Year
df_joc <- subset(df_joc, select = -c(year, month))
# Fill NA's with previous value
df_joc <- fill(df_joc, names(df_joc))
# Create equal weighted composite
df_joc$joc_eq_wt = rowSums(df_joc[, -1]) / 15
# Scale Values to 100
df_joc = df_joc %>%
mutate_each(funs(./.[1]*100), setdiff(names(.), "date"))
# lag CPI by 13 months
df_joc$cpilag13 = lead(df_joc$cpi, n=1)
df_joc_mod = df_joc
View(df_joc)
# Get data from BLS
df_joc = get_n_series_table(
list( copper ='wpu102301', cotton = 'wpu015', natgas = 'wpu0531', burlap = 'wpu033703', copper_nickel = 'wpu102', steelscrap = 'wpu1012', zinc = 'wpu102303', aluminum = 'wpu102302', hides = 'wpu041', rubber = 'wpu071', tallow = 'wpu06410132', plywood = 'wpu083', hardwood = 'wpu0812', aromatics = 'wpu06140197', crudepetroleum = 'wpu056', cpi = 'CUUR0000SA0'),
api_key = "9f4c1becb3c546b689e1b9804d877d1e",
start_year = 2005, end_year=2023, tidy=TRUE
)
# Create date from Mon and Year
df_joc = df_joc %>%
mutate(df_joc, date=paste(year,month,1,sep="-"))
df_joc$date = ymd(df_joc$date)
# Make date first column
df_joc = df_joc %>% relocate(date)
# Rmove Mon and Year
df_joc <- subset(df_joc, select = -c(year, month))
# Fill NA's with previous value
df_joc <- fill(df_joc, names(df_joc))
# Create equal weighted composite
df_joc$joc_eq_wt = rowSums(df_joc[, -1]) / 15
# Scale Values to 100
df_joc = df_joc %>%
mutate_each(funs(./.[1]*100), setdiff(names(.), "date"))
# lag CPI by 13 months
df_joc$cpilag13 = lead(df_joc$cpi, n=13)
df_joc_mod = df_joc
View(df_joc)
ggplot(df_joc, aes( x= date, y=cpi)) +
geom_line(aes(x = date, y = cpi * 2), color = "red") +
geom_line(aes(x = date, y = joc_eq_wt))
+
geom_line(aes(y = delta_cpi, col = "CPI")) +
geom_line(aes(y = delta_shelter, col = "CPI Shelter")) +
geom_line(aes(y = delta_housing, col = "Shiller Housing")) +
add_rec_shade(min(df_cpi_adj$date),max(df_cpi_adj$date)) +  # Add recessions
labs(x = "Date") +
labs(y = "Alternative CPI's") +
labs(caption = "CPI adjusted by removing CPI Shelter (FRED/CUSR0000SAH1) and substituting Shiller Housing data (YALE/NHPI)", color = "Rates:") +
labs(title = "CPI Adjusted for True Cost of Housing") +
scale_x_date(date_breaks = "5 years", labels=date_format("%Y")) +
geom_dl(aes(label=last_value)
, method = list("last.qp")) +
ggthemes:: theme_economist_white()
df_joc_mod = df_joc
df_joc_mod = df_joc_mod %>%
dplyr::select(-c(cpi))
# add date column back in
df_joc_mod = df_joc_mod %>%
mutate(date = df_joc$date, .before = copper)
# Detrend data
df_joc_mod = df_joc %>%
mutate(joc_eq_wt_diff = joc_eq_wt - lag(joc_eq_wt, n = 12)) %>%
mutate(cpilag13_diff = cpilag13 - lag(cpilag13, n = 12))
ggplot(df_joc_mod, aes(joc_eq_wt_diff, cpilag13_diff)) +
geom_point(aes(color = date)) +
geom_path(aes(color = date))
View(df_joc)
ggplot(data = df_joc_mod,aes(joc_eq_wt_diff, cpilag13_diff)) +
stat_summary(fun.data= mean_cl_normal) +
geom_smooth(method='lm')
